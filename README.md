# **虚拟化与云计算技术**

**课程代码：** CSE33205C
**授课教师：** 尤国华
**E-mail：** [yough@mail.buct.edu.cn](mailto:yough@mail.buct.edu.cn)

---

## **内容提示**

* 虚拟化技术能：

  * 提升基础设施利用率，实现运营成本最小化；
  * 通过整合应用栈与即时镜像部署，实现业务的高效与敏捷。
* 容器技术是目前最普遍的软件部署虚拟化技术。
* 实施虚拟化分为三个阶段：

  1. 创建
  2. 部署
  3. 管理

---

## **大纲目录**

1. 容器技术
2. 创建虚拟化解决方案
3. 部署虚拟化解决方案
4. 管理虚拟化解决方案
5. 小结

---

# **第一章 容器技术**

## **1. 定义**

容器是一种**轻量级虚拟化技术**，将应用程序及其依赖（代码、库、运行时、配置）封装在标准单元中，实现**跨平台一致运行**。

## **2. 部署方式比较**

* 传统部署
* 虚拟化部署
* 容器部署

## **3. 容器与虚机对比**

容器更轻量、启动更快、资源开销更低。

---

## **Linux容器关键技术**

### **1. cgroup（Control Group）——硬件资源隔离**

* **作用：** 资源隔离与限制。
* **功能：** 控制CPU、内存、带宽、I/O占比与次数。
* **示例：**

  ```bash
  echo 2G > /sys/fs/cgroup/memory/cgroup1/memory.limit_in_bytes
  ```

### **2. Namespace——操作系统资源隔离**

* **作用：** 容器隔离的基础。
* **功能：** 独立的PID、网络、挂载、用户ID空间；保障安全与稳定。

### **3. Union File System（联合文件系统）**

* **作用：** 将多个目录合并为一个逻辑目录。
* **功能：** 容器在镜像上创建“瘦读写层”，镜像可共享。
* **常见类型：** UnionFS、AUFS、OverlayFS。

---

## **Docker 技术**

* **定义：** 一种创建、管理、编排容器的软件。
* **演变：** DotCloud → Docker。
* **关键内容：**

  * Docker架构
  * 单节点编排
  * `Compose.yaml` 文件
  * `Dockerfile` 文件
  * 集群编排（Swarm/Kubernetes）

---

# **第二章 创建虚拟化解决方案**

## **1. 创建基本虚拟镜像**

### **概念**

* **虚拟机（VM）：** 具有完整硬件功能的逻辑计算机。
* **虚拟镜像：** 虚拟机的存储实体，包含配置与磁盘数据。

### **分类**

* **无状态镜像：** 仅磁盘数据。
* **有状态镜像：** 含内存快照。

### **创建流程**

1. 设置虚拟硬件参数
2. 安装操作系统与软件
3. 保存镜像与配置

---

## **2. 创建虚拟器件镜像**

### **定义**

虚拟器件（Virtual Appliance）= 操作系统 + 中间件 + 应用程序的预配置虚拟机。

### **优点**

部署简便、环境统一。

### **创建流程**

1. 分析服务组成
2. 编写配置脚本
3. 制作通用模板
4. 生成实例并交付

---

## **3. 发布虚拟器件镜像**

### **标准：** DMTF 的 **OVF（Open Virtualization Format）**

* 提供开放、安全、可移植的虚拟器件描述格式。

### **三类格式**

1. OVF描述文件
2. OVA发布包
3. OVF Environment部署配置

### **OVF文件作用**

* 描述虚拟器件数量、配置、关系、启动顺序。
* 基于XML格式。

---

## **4. 管理虚拟器件镜像**

### **挑战**

镜像体积大、数量多。

### **目标**

* 快速检索
* 节省空间
* 版本控制

### **管理方法**

分离存储：

* 元数据（文件名、大小、日期、权限、指针）
* 内容（切片+摘要标识符）

---

## **5. 迁移到虚拟化环境**

### **P2V（Physical to Virtual）**

* 将物理系统整体迁移至虚拟环境。
* **优势：** 无需修改应用代码。

### **步骤**

1. 制作镜像
2. 替换硬件驱动
3. 启动虚拟实例

### **Converter工具流程**

1. 安装代理并做快照
2. 创建虚拟机并复制卷
3. 安装驱动并定制配置

---

# **第三章 部署虚拟化解决方案**

## **1. 规划部署环境**

### **优点**

提升资源利用率，降低能耗。

### **问题**

管理复杂性上升。

### **部署步骤**

1. 投资回报分析
2. 资源统一规划

### **厂商选择**

* **国内：** 华为FusionSphere、H3C UIS、阿里飞天、ZStack
* **国外：** VMware vSphere、Citrix Xen、微软Hyper-V

---

## **2. 部署虚拟器件**

### **流程（6步）**

1. 选择并定制虚拟器件
2. 生成OVF Environment文件
3. 选择目标物理机
4. 拷贝镜像与配置
5. 启动虚拟器件
6. 激活虚拟器件

### **关键说明**

* 定制化参数包括硬件、软件、网络、安全策略。
* OVF文件通常以ISO镜像传入虚拟机内部。

---

## **3. 激活虚拟器件**

### **定义**

虚拟器件内部读取OVF Environment信息，实现软件定制。

### **激活方式**

1. 完全手动
2. 基于脚本的手动
3. 自动激活（单体）
4. 协同激活（多体）

---

# **第四章 管理虚拟化解决方案**

虚拟化数据中心通过**集中监控、便捷管理、动态优化、高效备份**提升运维效率。

---

## **1. 集中监控**

* 管控所有资源与虚拟器件状态。
* 示例：VMware vCenter。

---

## **2. 便捷管理**

### **三类管理对象**

1. 基础设施：物理节点、网络、存储
2. 虚拟机：启动、迁移、快照
3. 虚机内应用：启动、配置

### **内部管理模块**

* 工具：`vmtools`、`castools`、ZStack优化工具
* 支持第三方扩展管理。

---

## **3. 动态优化**

### **定义**

根据负载变化动态分配资源，提升性能、避免浪费。

### **核心组成**

* 实时监控
* 动态调度算法

---

## **4. 高效备份**

### **虚拟机内备份**

* 类似物理机备份
* 优点：兼容传统方式
* 缺点：侵入性强、管理繁琐

### **虚拟机外备份**

* 依赖快照技术
* 优点：速度快、不侵入业务
* 缺点：需专用设备、成本高

---

# **第五章 小结**

请结合各章节重点内容自行总结，包括：

* 容器与虚拟机对比
* OVF标准与虚拟器件发布流程
* 虚拟化部署与激活过程
* 虚拟化数据中心的管理与优化方法

---
